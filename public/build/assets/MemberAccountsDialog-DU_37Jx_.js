import{j as e,W as S,r as k}from"./app-HoDmrXNN.js";import{I as d}from"./InputError-TOSMNCfi.js";import{B as y}from"./badge-BsozPfPs.js";import{B as b}from"./button-BJi7Ukxl.js";import{C as h,a as p,b as j,c as _,d as B}from"./card-DJOBn3Fy.js";import{D as g,b as N,c as M,d as V,e as I,a as H}from"./dialog-CErlIxQH.js";import{I as m}from"./input-CiGtSvJf.js";import{L as o}from"./label-CL0pq-nz.js";import{S as v,a as C,b as T,c as R,d as c}from"./select-CZrVjgA_.js";import{T as Q,a as O,b as w,c as r,d as q,e as i}from"./table-BBGnmZM7.js";import{T as z}from"./textarea-BcKiGzl-.js";import{t as L}from"./use-toast-CIr2tFUS.js";import{f as W}from"./format-CE4V3joc.js";import"./index-Bb4qSo10.js";import"./utils-C-Zvzyq5.js";import"./index-CFlD9-z1.js";import"./index-Ddbn_Yk1.js";import"./index-CuHBRXKR.js";import"./index-D_DgHOsp.js";import"./index-DmpELkTC.js";import"./x-hw2QYuFl.js";import"./createLucideIcon-B5c7f2k6.js";import"./index-CZNwChqj.js";import"./index-DZm7ZyEy.js";import"./check-DBLKpwDX.js";function _e({member:l,open:D,onClose:A}){const u=Object.values(l.all_payments);console.log("ledger",u),u.sort((t,a)=>{const n=new Date(t.updated_at||t.created_at);return new Date(a.updated_at||a.created_at).getTime()-n.getTime()});const E=()=>{const{data:t,setData:a,errors:n,post:x,processing:f,reset:P}=S({member_id:l.id,transaction_type:"",refund_amount:"",description:"",total_amount:"",paid_amount:"",payment_date:"",payment_mode:"",bill_number:"",payment_voucher:""}),$=s=>{s.preventDefault(),x("/transactions/store",{onSuccess:()=>{L({description:"Transaction created successfully..."}),P()}})};return k.useEffect(()=>{t.transaction_type==="credit-payment"&&a("total_amount","0")},[t.payment_mode]),e.jsxs(g,{children:[e.jsx(H,{asChild:!0,children:e.jsx(b,{variant:"default",className:"w-fit ms-auto",children:"Add Transaction"})}),e.jsx(N,{className:"max-w-[500px]",children:e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium leading-none",children:"Add Transaction"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Enter the miscellaneous transaction details for"," ",e.jsx("strong",{children:l.name})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Transaction Type"}),e.jsxs(v,{value:t.transaction_type,onValueChange:s=>a("transaction_type",s),children:[e.jsx(C,{children:e.jsx(T,{placeholder:"Select transaction type"})}),e.jsxs(R,{children:[e.jsx(c,{value:"service",children:"Service"}),e.jsx(c,{value:"product",children:"Product"}),e.jsx(c,{value:"credit-payment",children:"Credit Payment"}),e.jsx(c,{value:"refund",children:"Refund"}),e.jsx(c,{value:"others",children:"Others"})]})]}),e.jsx(d,{message:n.transaction_type})]}),t.transaction_type!=="credit-payment"&&t.transaction_type!=="refund"&&e.jsxs("div",{children:[e.jsx(o,{children:"Total Amount"}),e.jsx(m,{type:"number",placeholder:"Enter total amount",value:t.total_amount,onChange:s=>a("total_amount",s.target.value)}),e.jsx(d,{message:n.total_amount})]}),t.transaction_type==="refund"&&e.jsxs("div",{children:[e.jsx(o,{children:"Refund Amount"}),e.jsx(m,{type:"number",placeholder:"Enter refund amount",value:t.refund_amount,onChange:s=>a("refund_amount",s.target.value)}),e.jsx(d,{message:n.refund_amount})]}),t.transaction_type!=="refund"&&e.jsxs("div",{children:[e.jsx(o,{children:"Payment Amount"}),e.jsx(m,{type:"number",placeholder:"Enter paid amount",value:t.paid_amount,onChange:s=>a("paid_amount",s.target.value)}),e.jsx(d,{message:n.paid_amount})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Payment Mode"}),e.jsxs(v,{value:t.payment_mode,onValueChange:s=>a("payment_mode",s),children:[e.jsx(C,{children:e.jsx(T,{placeholder:"Select payment mode"})}),e.jsxs(R,{children:[e.jsx(c,{value:"Cash",children:"Cash"}),e.jsx(c,{value:"QR",children:"QR"}),e.jsx(c,{value:"Cash + QR",children:"Cash + QR"}),e.jsx(c,{value:"Cheque",children:"Cheque"}),t.transaction_type!=="credit-payment"&&e.jsx(c,{value:"Credit",children:"Credit"})]})]}),e.jsx(d,{message:n.payment_mode})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Payment Date"}),e.jsx(m,{type:"date",value:t.payment_date,onChange:s=>a("payment_date",s.target.value)}),e.jsx(d,{message:n.payment_date})]}),t.transaction_type!=="refund"&&e.jsxs("div",{className:t.transaction_type==="credit-payment"?"col-span-full":"",children:[e.jsx(o,{children:"Bill Number (optional)"}),e.jsx(m,{placeholder:"Enter bill number (if applicable)",onChange:s=>a("bill_number",s.target.value)}),e.jsx(d,{message:n.bill_number})]}),t.transaction_type==="refund"&&e.jsxs("div",{className:"col-span-full",children:[e.jsx(o,{children:"Payment Voucher"}),e.jsx(m,{placeholder:"Enter payment voucher number",onChange:s=>a("payment_voucher",s.target.value)}),e.jsx(d,{message:n.payment_voucher})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Description"}),e.jsx(z,{placeholder:"Enter description of the transaction",value:t.description,onChange:s=>a("description",s.target.value)}),e.jsx(d,{message:n.description})]}),e.jsx(b,{type:"submit",className:"mt-4 w-full",disabled:f,children:f?"Processing...":"Create Transaction"})]})})]})};return e.jsx(g,{open:D,onOpenChange:A,children:e.jsxs(N,{className:"max-w-[1600px] w-[95vw] max-h-[99vh] overflow-auto",children:[e.jsxs(M,{children:[e.jsx(V,{children:"Member Transactions"}),e.jsx(I,{children:"Efficiently analyze the payments of a member."})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(h,{className:"bg-blue-500",children:e.jsxs(p,{children:[e.jsx(j,{className:"text-white",children:u.length}),e.jsx(_,{className:"text-white/80",children:"Total Transactions"})]})}),e.jsx(h,{className:"bg-fuchsia-600",children:e.jsxs(p,{children:[e.jsxs(j,{className:"text-white",children:[" ","Rs"," ",u.reduce((t,a)=>{const n=Number(a.paid_amount)||0,x=Number(a.refund_amount)||0;return t+n-x},0)]}),e.jsx(_,{className:"text-white/80",children:"Total Paid Amount"})]})}),e.jsx(h,{className:l.credit>0?"bg-red-500":"bg-green-500",children:e.jsxs(p,{children:[e.jsxs(j,{className:"text-white",children:["Rs ",Math.abs(Number(l.credit))]}),e.jsxs(_,{className:"text-white/80",children:["Total"," ",l.credit<=0?" Advance ":" Credit "," ","Amount"]})]})})]}),e.jsx("div",{className:"w-fit ms-auto space-x-2",children:e.jsx(E,{})}),e.jsx(h,{children:e.jsx(B,{children:e.jsxs(Q,{className:"text-center",children:[e.jsx(O,{children:e.jsxs(w,{className:"hover:bg-card",children:[e.jsx(r,{className:"text-center",children:"Date"}),e.jsx(r,{className:"text-center",children:"Total"}),e.jsx(r,{className:"text-center",children:"Extra Disc."}),e.jsx(r,{className:"text-center",children:"Net Amount"}),e.jsx(r,{className:"text-center",children:"Paid"}),e.jsx(r,{className:"text-center",children:"Credit/Adv."}),e.jsx(r,{className:"text-center",children:"Bill/PV No."}),e.jsx(r,{className:"text-center",children:"Transaction Type"}),e.jsx(r,{className:"text-center",children:"Payment Mode"}),e.jsx(r,{className:"text-center",children:"Payment Proof"}),e.jsx(r,{className:"text-center",children:"Remarks"})]})}),e.jsx(q,{children:u.map(t=>{const a=t.paid_amount?Number(t.net_amount-t.paid_amount):Number(t.net_amount);return e.jsxs(w,{className:"hover:bg-muted/15",children:[e.jsx(i,{children:W(new Date(t.payment_date||t.created_at),"MMM d, yyyy")}),e.jsx(i,{children:(()=>{if(t.type==="credit-payment")return`Rs ${Number(t.paid_amount)}`;if(Number(t.refund_amount)!==0&&t.refund_amount!==null)return`Rs ${Number(t.refund_amount)}`;if(Number(t.extra_discount)&&t.type==="entry")return`Rs ${Number(t.total_months)*Number(t.total_monthly_fees)+Number(t.admission_fees)-Number(t.package_discount)}`;if(Number(t.extra_discount)&&t.type==="renewal")return`Rs ${Number(t.extra_discount)+Number(t.net_amount)}`;if(Number(t.locker_discount)&&t.type==="locker")return`Rs ${Number(t.locker_discount)+Number(t.net_amount)}`;if(t.net_amount)return`Rs ${Number(t.net_amount)}`})()}),e.jsx(i,{children:t.extra_discount?`Rs ${Number(t.extra_discount)}`:t.locker_discount?`Rs ${Number(t.locker_discount)}`:"-"}),e.jsx(i,{children:Number(t.refund_amount)?`Rs ${Number(t.refund_amount)}`:`Rs ${Number(t.net_amount)}`}),e.jsx(i,{children:t.paid_amount?`Rs ${Number(t.paid_amount)}`:"-"}),e.jsx(i,{children:t.refund_amount?"":e.jsx("small",{className:"px-3 py-1 rounded-full text-white font-bold "+(a>0?"bg-red-500":a<0?"bg-green-500":"text-black"),children:a>=0?`Rs ${a}`:`Rs ${Math.abs(a)}`})}),e.jsx(i,{children:t.bill_number?e.jsx(y,{children:t.bill_number}):e.jsx(y,{children:t.payment_voucher})}),e.jsxs(i,{className:"capitalize",children:[t.type||"Credit Added",t.locker_months>0?e.jsx("span",{children:" + locker"}):""]}),e.jsx(i,{children:t.payment_mode||"-"}),e.jsx(i,{children:t.payment_proof?e.jsx("a",{href:t.payment_proof,target:"_blank",rel:"noopener noreferrer",className:"text-gray-500 underline hover:text-purple-700",children:"View"}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(i,{children:t.description||"-"})]},t.id)})})]})})})]})})}export{_e as MemberAccountsDialog};
