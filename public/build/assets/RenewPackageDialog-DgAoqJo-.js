import{q as Y,r as c,W as $,j as e}from"./app-HoDmrXNN.js";import{C as f,a as _,b as v,d as b}from"./card-DJOBn3Fy.js";import{D as z,b as J,c as K,d as U,e as X,f as Z}from"./dialog-CErlIxQH.js";import{S as w,a as N,b as C,c as D,d as a}from"./select-CZrVjgA_.js";import{I as p}from"./input-CiGtSvJf.js";import{B as ee}from"./button-BJi7Ukxl.js";import{L as m}from"./label-CL0pq-nz.js";import{I as h}from"./InputError-TOSMNCfi.js";import{t as se}from"./use-toast-CIr2tFUS.js";import"./utils-C-Zvzyq5.js";import"./index-Ddbn_Yk1.js";import"./index-CuHBRXKR.js";import"./index-D_DgHOsp.js";import"./index-DmpELkTC.js";import"./x-hw2QYuFl.js";import"./createLucideIcon-B5c7f2k6.js";import"./index-CZNwChqj.js";import"./index-DZm7ZyEy.js";import"./check-DBLKpwDX.js";import"./index-CFlD9-z1.js";import"./index-Bb4qSo10.js";const te=({member:d,open:R,onClose:y})=>{const n=Y().props.packages.find(s=>s.id===d.membership_package_id),j=c.useRef(null),{data:t,setData:r,reset:S,errors:x,post:E,processing:M,clearErrors:A}=$({selected_months:1,extra_discount:0,paid_amount:0,bill_number:"",payment_mode:"",new_payment_expiry:""}),[k,F]=c.useState(0),[q,I]=c.useState(0),[P,B]=c.useState(0),[T,Q]=c.useState(0),[i,L]=c.useState(0),O=s=>{const o=new Date,l=new Date(d.payment_expiry_date),u=o>l?o:l;return new Date(u.setMonth(u.getMonth()+s)).toISOString().split("T")[0]};c.useEffect(()=>{if(n){const s=Number(n.monthly_amount)||0,o=s*t.selected_months;let l=0;t.selected_months===3?l=Number(n.discount_quarterly)||0:t.selected_months===6?l=Number(n.discount_half_yearly)||0:t.selected_months===12&&(l=Number(n.discount_yearly)||0);const u=o,g=u-l-t.extra_discount;F(s),I(o),B(u),Q(l),L(Math.max(g,0));const W=O(t.selected_months);r("new_payment_expiry",W)}},[t.selected_months,t.extra_discount,n]);const V=()=>t.paid_amount>i?"Advance Amount":"Credit Amount",G=()=>t.paid_amount>i?t.paid_amount-i:i-t.paid_amount,H=s=>{if(s.preventDefault(),M)return!1;console.log("Form Data:",t),A(),E(route("renewal.store",d.id),{onSuccess:o=>{console.log(o),se({description:"Package Renewed Successfully..."}),y(),S()}})};return e.jsx(z,{open:R,onOpenChange:y,children:e.jsxs(J,{className:"max-w-4xl w-[95vw] mx-auto rounded-lg p-6 shadow-lg overflow-auto max-h-[95vh]",children:[e.jsxs(K,{children:[e.jsx(U,{className:"text-xl font-semibold",children:"Package Renewal"}),e.jsxs(X,{className:"text-sm",children:["Renew membership package of"," ",e.jsx("strong",{children:d.name}),"."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:[e.jsxs(f,{children:[e.jsx(_,{children:e.jsx(v,{className:"text-lg font-semibold",children:"Pricing Summary"})}),e.jsxs(b,{children:[e.jsx("b",{children:n==null?void 0:n.package_name}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Current Expiry Date"}),e.jsx("strong",{children:d.payment_expiry_date})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Renewal Months"}),e.jsxs("span",{children:[t.selected_months," ",t.selected_months===1?"Month":"Months"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Monthly Fees"}),e.jsxs("span",{children:["Rs ",k]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Calculated Monthly Fees"}),e.jsxs("span",{children:["Rs ",q]})]}),e.jsx("div",{className:"border-t my-2"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Gross Amount"}),e.jsxs("span",{children:["Rs ",P]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["- Rs ",T]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Extra Discount"}),e.jsxs("span",{children:["- Rs ",t.extra_discount]})]}),e.jsx("div",{className:"border-t my-2"}),e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Net Amount"}),e.jsxs("span",{className:"cursor-pointer",onClick:()=>{j.current&&(r("paid_amount",i),j.current.value=i.toString())},children:["Rs ",i]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:V()}),e.jsxs("span",{children:["Rs ",G()]})]})]})]}),e.jsxs(f,{children:[e.jsx(_,{children:e.jsx(v,{className:"text-lg",children:"Renewal Information"})}),e.jsx(b,{className:"space-y-4",children:e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Renewal Period"}),e.jsxs(w,{value:t.selected_months.toString(),onValueChange:s=>r("selected_months",Number(s)),children:[e.jsx(N,{id:"months",children:e.jsx(C,{placeholder:"Select extension period"})}),e.jsxs(D,{children:[e.jsx(a,{value:"1",children:"1 Month"}),e.jsx(a,{value:"3",children:"3 Months"}),e.jsx(a,{value:"6",children:"6 Months"}),e.jsx(a,{value:"12",children:"1 Year"})]})]}),e.jsx(h,{message:x.selected_months})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Payment Expiry Date"}),e.jsx(p,{type:"date",value:new Date(t.new_payment_expiry||d.payment_expiry_date).toISOString().split("T")[0],onChange:s=>r("new_payment_expiry",s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Payment Method"}),e.jsxs(w,{value:t.payment_mode,onValueChange:s=>r("payment_mode",s),children:[e.jsx(N,{id:"payment-method",children:e.jsx(C,{placeholder:"Select payment method"})}),e.jsxs(D,{children:[e.jsx(a,{value:"Cash",children:"Cash"}),e.jsx(a,{value:"QR",children:"QR"}),e.jsx(a,{value:"Cash + QR",children:"Cash + QR"}),e.jsx(a,{value:"Cheque",children:"Cheque"}),e.jsx(a,{value:"Credit",children:"Credit"})]})]}),e.jsx(h,{message:x.payment_mode})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Bill Number"}),e.jsx(p,{type:"text",placeholder:"Enter bill number",onChange:s=>r("bill_number",s.target.value),required:!0}),e.jsx(h,{message:x.bill_number})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Extra Discount (Rs)"}),e.jsx(p,{type:"number",placeholder:"Enter extra discount",onChange:s=>r("extra_discount",Number(s.target.value)),required:!0}),e.jsx(h,{message:x.extra_discount})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Paid Amount (Rs)"}),e.jsx(p,{type:"number",placeholder:"Enter amount paid",ref:j,onChange:s=>r("paid_amount",Number(s.target.value)),required:!0}),e.jsx(h,{message:x.paid_amount})]})]}),e.jsx(ee,{children:"Confirm Renewal"})]})})]})]}),e.jsx(Z,{})]})})},Ce=te;export{Ce as default};
