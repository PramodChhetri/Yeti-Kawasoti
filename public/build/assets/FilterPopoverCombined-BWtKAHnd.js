import{q as H,r as p,j as e,y as I}from"./app-CeHawWK7.js";import{I as x}from"./input-iG9gLFRb.js";import{B as C}from"./button-CBFDvSSe.js";import{D as J,a as W,b as q,c as $,d as Q,f as X}from"./dialog-vdBOxT0G.js";import{L as f}from"./label-DZHSVrJR.js";import{S as _}from"./segmented-control-BJ3PsD5-.js";import{S as E,a as U,b as L,c as V,d as g}from"./select-CrO88sMk.js";import{T as Y,a as Z,b as A,c as k}from"./tabs-BAfxlyZP.js";import{F as ee}from"./filter-DSXKKHjN.js";import"./utils-CRrpu23W.js";import"./index-Clynsdhc.js";import"./index-Bb4qSo10.js";import"./index-DmAnl5gc.js";import"./index-B_ku7PSA.js";import"./index-DD1TA57H.js";import"./index-C9wzw3Ty.js";import"./x-CcTwlrmH.js";import"./createLucideIcon-T09ZsU69.js";import"./index-JWIwkwlr.js";import"./index-BBHitacn.js";import"./check-U2lRsC70.js";import"./index-CRFetRKe.js";function ae(b){const D=new URLSearchParams(b.split("?")[1]),c={},r={},h={},v=(j,m,i)=>{m.reduce((l,t,n)=>(n===m.length-1?l[t]=i:l[t]=l[t]||{},l[t]),j)};for(const[j,m]of D.entries())if(j.startsWith("filter[")){const i=j.match(/filter\[(.+?)\]/);if(i&&i[1]){const l=i[1],t=l.split(/\[|\]/).filter(Boolean);if(l.startsWith("member_")){const n=l.substring(7);if(n.includes("[")){const d=n.match(/(.+?)\[(.+?)\]/);if(d){const o=d[1],u=d[2];r[o]||(r[o]={}),r[o][u]=m}}else r[n]=m}else if(l.startsWith("official_")){const n=l.substring(9);if(n.includes("[")){const d=n.match(/(.+?)\[(.+?)\]/);if(d){const o=d[1],u=d[2];h[o]||(h[o]={}),h[o][u]=m}}else h[n]=m}else v(c,t,m)}}return{filters:c,memberFilters:r,officialFilters:h}}function ye({packages:b}){var w,M,O,T,G,K,P;const D=H().url,{memberFilters:c,officialFilters:r}=ae(D),[h,v]=p.useState(!1),[j,m]=p.useState("both"),[i,l]=p.useState({membership_package_id:c.membership_package_id||"all",gender:c.gender||"all",status:c.status||"all",joiningDateRange:{start:((w=c.start_date)==null?void 0:w.start)||"",end:((M=c.start_date)==null?void 0:M.end)||""},expiryDateRange:{start:((O=c.payment_expiry_date)==null?void 0:O.start)||"",end:((T=c.payment_expiry_date)==null?void 0:T.end)||""}}),[t,n]=p.useState({position:r.position||"all",gender:r.gender||"all",status:r.status||"all",joiningDateRange:{start:((G=r.joining_date)==null?void 0:G.start)||"",end:((K=r.joining_date)==null?void 0:K.end)||""}}),[d,o]=p.useState(i.gender),[u,R]=p.useState(i.status),[y,N]=p.useState(t.gender),[S,F]=p.useState(t.status);p.useEffect(()=>{o(i.gender),R(i.status),N(t.gender),F(t.status)},[i.gender,i.status,t.gender,t.status]);const B=()=>{const a=new URLSearchParams;a.append("recipient_type","both"),a.append("auto_load","false"),a.append("filter[member_filter]","true"),i.membership_package_id!=="all"&&a.append("filter[member_membership_package_id]",i.membership_package_id),i.gender!=="all"&&a.append("filter[member_gender]",i.gender),i.status!=="all"&&a.append("filter[member_status]",i.status),i.joiningDateRange.start&&a.append("filter[member_start_date][start]",i.joiningDateRange.start),i.joiningDateRange.end&&a.append("filter[member_start_date][end]",i.joiningDateRange.end),i.expiryDateRange.start&&a.append("filter[member_payment_expiry_date][start]",i.expiryDateRange.start),i.expiryDateRange.end&&a.append("filter[member_payment_expiry_date][end]",i.expiryDateRange.end),a.append("official_filter_enabled","true"),t.position!=="all"&&a.append("filter[official_position]",t.position),t.gender!=="all"&&a.append("filter[official_gender]",t.gender),t.status!=="all"&&a.append("filter[official_status]",t.status),t.joiningDateRange.start&&a.append("filter[official_joining_date][start]",t.joiningDateRange.start),t.joiningDateRange.end&&a.append("filter[official_joining_date][end]",t.joiningDateRange.end),console.log("Applying combined filters:",Object.fromEntries(a.entries())),v(!1);const s=`/messenging?${a.toString()}`;I.visit(s)},z=()=>{l({membership_package_id:"all",gender:"all",status:"all",joiningDateRange:{start:"",end:""},expiryDateRange:{start:"",end:""}}),n({position:"all",gender:"all",status:"all",joiningDateRange:{start:"",end:""}}),o("all"),R("all"),N("all"),F("all")};return e.jsxs(J,{open:h,onOpenChange:v,children:[e.jsx(W,{asChild:!0,children:e.jsxs(C,{variant:"secondary",className:"border",children:[e.jsx(ee,{size:14})," Â  Filter Recipients"]})}),e.jsxs(q,{className:"max-w-3xl max-h-[90vh] overflow-auto",children:[e.jsx($,{children:e.jsx(Q,{className:"text-lg font-bold",children:"Filter Members and Officials"})}),e.jsxs(Y,{value:j,onValueChange:m,className:"w-full",children:[e.jsxs(Z,{className:"grid grid-cols-3 mb-4",children:[e.jsx(A,{value:"members",children:"Member Filters"}),e.jsx(A,{value:"officials",children:"Official Filters"}),e.jsx(A,{value:"both",children:"Apply Both"})]}),e.jsx(k,{value:"members",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(f,{children:"Gender"}),e.jsx(_,{items:[{label:"Male",value:"male"},{label:"Female",value:"female"},{label:"All",value:"all"}],value:d,onChange:a=>{o(a),l(s=>({...s,gender:a}))}})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"membership-package",children:"Membership Package"}),e.jsxs(E,{value:i.membership_package_id,onValueChange:a=>l(s=>({...s,membership_package_id:a})),children:[e.jsx(U,{children:e.jsx(L,{placeholder:"Select membership package"})}),e.jsxs(V,{children:[e.jsx(g,{value:"all",children:"All"}),b.map(a=>e.jsx(g,{value:a.id.toString(),children:a.package_name},a.id))]})]})]}),e.jsxs("div",{className:"col-span-full",children:[e.jsx(f,{children:"Joining Date Range"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(x,{type:"date",name:"joining_start_date",value:i.joiningDateRange.start,onChange:a=>{l(s=>({...s,joiningDateRange:{...s.joiningDateRange,start:a.target.value}}))},className:"w-full"}),e.jsx("span",{children:"-"}),e.jsx(x,{type:"date",name:"joining_end_date",value:i.joiningDateRange.end,onChange:a=>l(s=>({...s,joiningDateRange:{...s.joiningDateRange,end:a.target.value}})),className:"w-full"})]})]}),e.jsxs("div",{className:"col-span-full",children:[e.jsx(f,{children:"Expiry Date Range"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(x,{type:"date",name:"expiry_start_date",value:i.expiryDateRange.start,onChange:a=>{l(s=>({...s,expiryDateRange:{...s.expiryDateRange,start:a.target.value}}))},className:"w-full"}),e.jsx("span",{children:"-"}),e.jsx(x,{type:"date",name:"expiry_end_date",value:i.expiryDateRange.end,onChange:a=>l(s=>({...s,expiryDateRange:{...s.expiryDateRange,end:a.target.value}})),className:"w-full"})]})]}),e.jsxs("div",{className:"col-span-full",children:[e.jsx(f,{children:"Status"}),e.jsx(_,{items:[{label:"Active",value:"active"},{label:"Expired",value:"expired"},{label:"Unapproved",value:"unapproved"},{label:"All",value:"all"}],value:u,onChange:a=>{R(a),l(s=>({...s,status:a}))}})]})]})}),e.jsx(k,{value:"officials",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(f,{children:"Gender"}),e.jsx(_,{items:[{label:"Male",value:"male"},{label:"Female",value:"female"},{label:"All",value:"all"}],value:y,onChange:a=>{N(a),n(s=>({...s,gender:a}))}})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"position",children:"Position"}),e.jsxs(E,{value:t.position,onValueChange:a=>{n(s=>({...s,position:a}))},children:[e.jsx(U,{children:e.jsx(L,{placeholder:"Select position"})}),e.jsxs(V,{children:[e.jsx(g,{value:"all",children:"All"}),e.jsx(g,{value:"Owner",children:"Owner"}),e.jsx(g,{value:"Manager",children:"Manager"}),e.jsx(g,{value:"Trainer",children:"Trainer"}),e.jsx(g,{value:"Reception",children:"Reception"}),e.jsx(g,{value:"Guard",children:"Guard"}),e.jsx(g,{value:"House-Keeping",children:"House Keeping"}),e.jsx(g,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"col-span-full",children:[e.jsx(f,{children:"Joining Date Range"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(x,{type:"date",name:"official_joining_start_date",value:t.joiningDateRange.start,onChange:a=>{n(s=>({...s,joiningDateRange:{...s.joiningDateRange,start:a.target.value}}))},className:"w-full"}),e.jsx("span",{children:"-"}),e.jsx(x,{type:"date",name:"official_joining_end_date",value:t.joiningDateRange.end,onChange:a=>n(s=>({...s,joiningDateRange:{...s.joiningDateRange,end:a.target.value}})),className:"w-full"})]})]}),e.jsxs("div",{className:"col-span-full",children:[e.jsx(f,{children:"Status"}),e.jsx(_,{items:[{label:"Active",value:"active"},{label:"Disabled",value:"disabled"},{label:"All",value:"all"}],value:S,onChange:a=>{F(a),n(s=>({...s,status:a}))}})]})]})}),e.jsxs(k,{value:"both",className:"space-y-4",children:[e.jsxs("div",{className:"border p-4 rounded-md mb-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Member Filters"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Gender:"})," ",d==="all"?"All":d]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",u==="all"?"All":u]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Package:"})," ",i.membership_package_id==="all"?"All":((P=b.find(a=>a.id.toString()===i.membership_package_id))==null?void 0:P.package_name)||"Unknown"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Date Ranges:"})," ",i.joiningDateRange.start||i.joiningDateRange.end||i.expiryDateRange.start||i.expiryDateRange.end?"Customized":"None"]})]})]}),e.jsxs("div",{className:"border p-4 rounded-md",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Official Filters"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Gender:"})," ",y==="all"?"All":y]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",S==="all"?"All":S]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Position:"})," ",t.position==="all"?"All":t.position]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Joining Date:"})," ",t.joiningDateRange.start||t.joiningDateRange.end?"Customized":"None"]})]})]}),e.jsx("div",{className:"p-4 bg-gray-100 rounded-md mt-4",children:e.jsx("p",{className:"text-sm text-gray-600",children:"Applying both filters will search for contacts matching either member OR official criteria. This will combine the results from both filter sets."})})]})]}),e.jsxs(X,{className:"flex justify-end space-x-2 mt-4",children:[e.jsx(C,{variant:"outline",onClick:z,children:"Clear All"}),e.jsx(C,{onClick:B,children:"Apply Filters"})]})]})]})}export{ye as default};
