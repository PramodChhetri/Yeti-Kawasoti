import{q as w,r as m,j as e,y as P}from"./app-CeHawWK7.js";import{I as f}from"./input-iG9gLFRb.js";import{B as x}from"./button-CBFDvSSe.js";import{P as W,a as A,b as E}from"./popover-BfFK9Qtk.js";import{L as g}from"./label-DZHSVrJR.js";import{S as y}from"./segmented-control-BJ3PsD5-.js";import{S as L,a as U,b as B,c as M,d as b}from"./select-CrO88sMk.js";import{F as G}from"./filter-DSXKKHjN.js";import"./utils-CRrpu23W.js";import"./index-Clynsdhc.js";import"./index-Bb4qSo10.js";import"./index-BBHitacn.js";import"./index-B_ku7PSA.js";import"./index-DD1TA57H.js";import"./index-C9wzw3Ty.js";import"./index-JWIwkwlr.js";import"./createLucideIcon-T09ZsU69.js";import"./check-U2lRsC70.js";function I(h){const p=new URLSearchParams(h.split("?")[1]),u={},n=(t,r,o)=>{r.reduce((i,l,c)=>(c===r.length-1?i[l]=o:i[l]=i[l]||{},i[l]),t)};for(const[t,r]of p.entries())if(t.startsWith("filter[")){const o=t.match(/filter\[(.+?)\]/);if(o&&o[1]){const l=o[1].split(/\[|\]/).filter(Boolean);n(u,l,r)}}return u}function ne({packages:h,recipientType:p="members"}){var j,_,v,R;const u=w().url,n=I(u),[t,r]=m.useState({membership_package_id:n.membership_package_id||"all",gender:n.gender||"all",status:n.status||"all",joiningDateRange:{start:((j=n.joiningDateRange)==null?void 0:j.start)||"",end:((_=n.joiningDateRange)==null?void 0:_.end)||""},expiryDateRange:{start:((v=n.expiryDateRange)==null?void 0:v.start)||"",end:((R=n.expiryDateRange)==null?void 0:R.end)||""}}),[o,i]=m.useState(t.gender),[l,c]=m.useState(t.status),D=m.useRef(null);m.useEffect(()=>{i(t.gender),c(t.status)},[t.gender,t.status]);const S=()=>{const a=new URLSearchParams;if(p&&a.append("recipient_type",p),a.append("auto_load","false"),t.membership_package_id!=="all"&&a.append("filter[membership_package_id]",t.membership_package_id),t.gender!=="all"&&a.append("filter[gender]",t.gender),t.status!=="all"&&a.append("filter[status]",t.status),t.joiningDateRange.start&&a.append("filter[start_date][start]",t.joiningDateRange.start),t.joiningDateRange.end&&a.append("filter[start_date][end]",t.joiningDateRange.end),t.expiryDateRange.start&&a.append("filter[payment_expiry_date][start]",t.expiryDateRange.start),t.expiryDateRange.end&&a.append("filter[payment_expiry_date][end]",t.expiryDateRange.end),p==="both"){const C=new URLSearchParams(window.location.search);for(const[d,F]of C.entries())d.startsWith("filter[")&&!d.startsWith("filter[gender]")&&!d.startsWith("filter[status]")&&!d.startsWith("filter[membership_package_id]")&&!d.startsWith("filter[start_date]")&&!d.startsWith("filter[payment_expiry_date]")&&a.append(d,F)}console.log("Applying member filters with params:",Object.fromEntries(a.entries()));const s=`/messenging?${a.toString()}`;P.visit(s)},N=()=>{r({membership_package_id:"all",gender:"all",status:"all",joiningDateRange:{start:"",end:""},expiryDateRange:{start:"",end:""}}),i("all"),c("all")},k=()=>p==="both"?"Filter Members":"Filter";return e.jsxs(W,{children:[e.jsx(A,{asChild:!0,children:e.jsxs(x,{variant:"secondary",className:"border",children:[e.jsx(G,{size:14})," Â  ",k()]})}),e.jsxs(E,{className:"p-4 space-y-4 w-fit max-w-full overflow-auto",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Filter Members"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(g,{children:"Gender"}),e.jsx(y,{items:[{label:"Male",value:"male"},{label:"Female",value:"female"},{label:"All",value:"all"}],value:o,onChange:a=>{i(a),r(s=>({...s,gender:a}))}})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"membership-package",children:"Membership Package"}),e.jsxs(L,{value:t.membership_package_id,onValueChange:a=>r(s=>({...s,membership_package_id:a})),children:[e.jsx(U,{children:e.jsx(B,{placeholder:"Select membership package"})}),e.jsxs(M,{children:[e.jsx(b,{value:"all",children:"All"}),h.map(a=>e.jsx(b,{value:a.id.toString(),children:a.package_name},a.id))]})]})]}),e.jsxs("div",{className:"col-span-full",children:[e.jsx(g,{children:"Joining Date Range"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(f,{type:"date",name:"joining_start_date",value:t.joiningDateRange.start,onChange:a=>{r(s=>({...s,joiningDateRange:{...s.joiningDateRange,start:a.target.value}}))},className:"w-full"}),e.jsx("span",{children:"-"}),e.jsx(f,{type:"date",name:"joining_end_date",value:t.joiningDateRange.end,onChange:a=>r(s=>({...s,joiningDateRange:{...s.joiningDateRange,end:a.target.value}})),className:"w-full"})]})]}),e.jsxs("div",{className:"col-span-full",children:[e.jsx(g,{children:"Payment Expiry Date Range"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(f,{type:"date",name:"expiry_start_date",value:t.expiryDateRange.start,onChange:a=>r(s=>({...s,expiryDateRange:{...s.expiryDateRange,start:a.target.value}})),className:"w-full"}),e.jsx("span",{children:"-"}),e.jsx(f,{type:"date",name:"expiry_end_date",value:t.expiryDateRange.end,onChange:a=>r(s=>({...s,expiryDateRange:{...s.expiryDateRange,end:a.target.value}})),className:"w-full"})]})]}),e.jsxs("div",{className:"col-span-full",children:[e.jsx(g,{children:"Status"}),e.jsx(y,{items:[{label:"Active",value:"active"},{label:"Expired",value:"expired"},{label:"Unapproved",value:"unapproved"},{label:"All",value:"all"}],value:l,onChange:a=>{c(a),r(s=>({...s,status:a}))}})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx(x,{variant:"outline",onClick:N,children:"Clear"}),e.jsx(x,{onClick:S,ref:D,children:"Apply"})]})]})]})}export{ne as default};
