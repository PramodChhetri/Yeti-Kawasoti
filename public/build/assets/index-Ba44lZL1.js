import{W as Z,r as m,j as e,Y as $}from"./app-DxhgH9la.js";import{I as i}from"./InputError-B6HEij25.js";import{B as ee}from"./button-CQRnvolg.js";import{C as y,a as P,b as E,d as w}from"./card-JPYiSOfV.js";import{I as o}from"./input-DTs6kzBN.js";import{L as t}from"./label-BCYFEXFM.js";import{S as h,a as u,b as x,c as p,d as r}from"./select-Kd40EoFx.js";import{S as se}from"./SingleImageUploader-DQ8W2twQ.js";import{t as ae}from"./use-toast-Tc-_Q_S1.js";import{A as te}from"./AuthenticatedLayout-Daqh-ZAm.js";import"./index-CDna1s6C.js";import"./index-Bb4qSo10.js";import"./utils-C-Zvzyq5.js";import"./index-mZgcqd2l.js";import"./index-CzHYO1du.js";import"./index-CF3a9R0E.js";import"./index-CXOfu3wE.js";import"./index-CirN_iVP.js";import"./createLucideIcon-BCR1lBT3.js";import"./check-eedJZ6Dw.js";import"./GlobalLayout-Bq7hwQH4.js";import"./toaster-bZriELgZ.js";import"./x-D4R6_HQS.js";import"./sheet-Cf9Z4Dtw.js";import"./index-4JGS_wby.js";import"./dropdown-menu-Dg02MNjQ.js";const Me=({auth:R,packages:j,lockers:g})=>{var A,D;const{data:a,setData:n,errors:l,post:I,processing:S,setError:ne,clearErrors:V}=Z({name:"",phone:"",occupation:"",gender:"",marital_status:"",date_of_birth:new Date(new Date().setFullYear(new Date().getFullYear()-20)).toISOString().split("T")[0],start_date:new Date(new Date().setFullYear(new Date().getFullYear())).toISOString().split("T")[0],address:"",preferred_time:"",membership_package:j[0].id,months:1,payment_mode:"",bill_number:0,extra_discount:0,photo:null,emergency_person_name:"",emergency_person_phone:"",locker_access:!1,locker_id:(A=g[0])==null?void 0:A.id,locker_discount:0,locker_number:"",paid:0,net_amount:0,days_count:1}),[T,q]=m.useState(0),[Y,L]=m.useState(0),[B,O]=m.useState(0),[G,Q]=m.useState(0),[U,H]=m.useState(0),[C,J]=m.useState(0),[W,k]=m.useState(0);m.useEffect(()=>{var c;const s=j.find(d=>d.id===a.membership_package);if(s){const d=Number(s.admission_amount)||0,_=Number(s.monthly_amount)||0,b=_*a.months,N=d+b;let f=0;a.months===3?f=Number(s.discount_quarterly)||0:a.months===6?f=Number(s.discount_half_yearly)||0:a.months===12&&(f=Number(s.discount_yearly)||0);const F=N-f,M=Math.min(a.extra_discount,F);q(d),L(_),O(b),Q(N),H(f),J(F-M),n("extra_discount",M)}if(a.locker_access){const d=g.find(N=>N.id===a.locker_id),_=d?d.price:0,b=Math.min(a.locker_discount,_);k(_-b),n("locker_discount",b)}else k(0),n("locker_discount",0),n("locker_id",((c=g[0])==null?void 0:c.id)||1)},[a.membership_package,a.months,a.extra_discount,a.locker_access,a.locker_id,a.locker_discount,j,g]);const v=()=>Number(a.months)===0?a.net_amount:C+W,z=()=>{const s=v();return(a.paid||0)>s?"Advance Amount":"Credit Amount"},K=()=>{const s=v(),c=a.paid||0;return c>s?c-s:s-c},X=s=>{s.preventDefault(),V(),I("/member/store",{onSuccess:()=>{var c;ae({description:"Member Created Successfully..."}),n({name:"",phone:"",occupation:"",gender:"",marital_status:"",date_of_birth:new Date(new Date().setFullYear(new Date().getFullYear()-20)).toISOString().split("T")[0],start_date:new Date(new Date().setFullYear(new Date().getFullYear()-20)).toISOString().split("T")[0],address:"",preferred_time:"",membership_package:j[0].id,months:1,payment_mode:"",bill_number:0,extra_discount:0,photo:null,emergency_person_name:"",emergency_person_phone:"",locker_access:!1,locker_id:(c=g[0])==null?void 0:c.id,locker_discount:0,locker_number:"",paid:0,net_amount:0,days_count:1})}})};return e.jsxs(te,{user:R.user,children:[e.jsx($,{title:"Create Member"}),e.jsxs("div",{className:"w-full mx-auto space-y-8",children:[e.jsx("div",{className:"flex justify-between",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Create a Membership"})}),e.jsx("form",{onSubmit:X,children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[e.jsxs("div",{className:"lg:col-span-6 xl:col-span-7 2xl:col-span-8 space-y-8",children:[e.jsxs(y,{children:[e.jsx(P,{children:e.jsx(E,{className:"text-lg",children:"Member Information"})}),e.jsxs(w,{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("div",{className:"w-32",children:[e.jsx(se,{onImageUpload:s=>n("photo",s),className:"aspect-square px-2 w-full",label:"Upload Member Photo"}),e.jsx(i,{message:l.photo,className:"mt-2"})]}),e.jsxs("div",{className:"flex-col grow",children:[e.jsxs("div",{className:"grow",children:[e.jsx(t,{htmlFor:"name",children:"Name"}),e.jsx(o,{id:"name",value:a.name,onChange:s=>{const c=s.target.value.toLowerCase().replace(/\b\w/g,d=>d.toUpperCase());n("name",c)},placeholder:"Enter member's name",required:!0}),e.jsx(i,{message:l.name,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"address",children:"Address"}),e.jsx(o,{id:"address",value:a.address,onChange:s=>n("address",s.target.value),placeholder:"Enter address",required:!0}),e.jsx(i,{message:l.address,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"phone",children:"Phone"}),e.jsx(o,{id:"phone",value:a.phone,onChange:s=>n("phone",s.target.value),placeholder:"Enter phone number",required:!0,maxLength:10,minLength:10}),e.jsx(i,{message:l.phone,className:"mt-2"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"phone",children:"Start Date"}),e.jsx(o,{id:"start_date",type:"date",value:a.start_date,onChange:s=>n("start_date",s.target.value),required:!0}),e.jsx(i,{message:l.start_date,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"occupation",children:"Occupation"}),e.jsxs(h,{defaultValue:a.occupation,onValueChange:s=>n("occupation",s),children:[e.jsx(u,{id:"occupation",children:e.jsx(x,{placeholder:"Select occupation"})}),e.jsxs(p,{children:[e.jsx(r,{value:"private-job",children:"Private Job"}),e.jsx(r,{value:"government-job",children:"Government Job"}),e.jsx(r,{value:"business",children:"Business"}),e.jsx(r,{value:"student",children:"Student"}),e.jsx(r,{value:"housewife",children:"House Wife"}),e.jsx(r,{value:"other",children:"Other"})]})]}),e.jsx(i,{message:l.occupation,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Gender"}),e.jsxs(h,{defaultValue:a.gender,onValueChange:s=>n("gender",s),children:[e.jsx(u,{id:"gender",children:e.jsx(x,{placeholder:"Select gender"})}),e.jsxs(p,{children:[e.jsx(r,{value:"male",children:"Male"}),e.jsx(r,{value:"female",children:"Female"})]})]}),e.jsx(i,{message:l.gender,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Marital Status"}),e.jsxs(h,{defaultValue:a.marital_status,onValueChange:s=>n("marital_status",s),children:[e.jsx(u,{id:"marital_status",children:e.jsx(x,{placeholder:"Select marital status"})}),e.jsxs(p,{children:[e.jsx(r,{value:"single",children:"Single"}),e.jsx(r,{value:"married",children:"Married"})]})]}),e.jsx(i,{message:l.marital_status,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"date_of_birth",children:"Date of Birth"}),e.jsx(o,{id:"date_of_birth",type:"date",value:a.date_of_birth,onChange:s=>n("date_of_birth",s.target.value),required:!0}),e.jsx(i,{message:l.date_of_birth,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"preferred_time",children:"Preferred Shift"}),e.jsxs(h,{onValueChange:s=>n("preferred_time",s),children:[e.jsx(u,{children:e.jsx(x,{placeholder:"Select preferred shift"})}),e.jsxs(p,{children:[e.jsx(r,{value:"Morning",children:"Morning"}),e.jsx(r,{value:"Day",children:"Day"}),e.jsx(r,{value:"Evening",children:"Evening"})]})]}),e.jsx(i,{message:l.preferred_time,className:"mt-2"})]})]})]})]}),e.jsxs(y,{children:[e.jsx(P,{children:e.jsx(E,{className:"text-lg",children:"Membership and Payment Details"})}),e.jsxs(w,{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("div",{className:"grow",children:[e.jsx(t,{htmlFor:"membership_package",children:"Membership Package"}),e.jsxs(h,{defaultValue:a.membership_package.toString(),onValueChange:s=>n("membership_package",Number(s)),children:[e.jsx(u,{id:"membership_package",children:e.jsx(x,{placeholder:"Select membership package"})}),e.jsx(p,{children:j.map(s=>e.jsx(r,{value:s.id.toString(),children:s.package_name},s.id))})]}),e.jsx(i,{message:l.membership_package,className:"mt-2"})]}),e.jsxs("div",{className:"grow",children:[e.jsx(t,{htmlFor:"months",children:"Initial Registration Months"}),e.jsxs(h,{defaultValue:a.months.toString(),onValueChange:s=>n("months",Number(s)),children:[e.jsx(u,{id:"months",children:e.jsx(x,{placeholder:"Select membership months"})}),e.jsxs(p,{children:[e.jsx(r,{value:"1",children:"1 Month"}),e.jsx(r,{value:"3",children:"3 Months"}),e.jsx(r,{value:"6",children:"6 Months"}),e.jsx(r,{value:"12",children:"1 Year"}),e.jsx(r,{value:"0",children:"Temporary"})]})]}),e.jsx(i,{message:l.months,className:"mt-2"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("div",{className:"grow",children:[e.jsx(t,{htmlFor:"payment_mode",children:"Payment Mode"}),e.jsxs(h,{defaultValue:a.payment_mode,onValueChange:s=>n("payment_mode",s),children:[e.jsx(u,{id:"payment_mode",children:e.jsx(x,{placeholder:"Select payment mode"})}),e.jsxs(p,{children:[e.jsx(r,{value:"Cash",children:"Cash"}),e.jsx(r,{value:"QR",children:"QR"}),e.jsx(r,{value:"Cash + QR",children:"Cash + QR"}),e.jsx(r,{value:"Cheque",children:"Cheque"})]})]}),e.jsx(i,{message:l.payment_mode,className:"mt-2"})]}),e.jsxs("div",{className:"grow",children:[e.jsx(t,{htmlFor:"bill_number",children:"Bill Number"}),e.jsx(o,{id:"bill_number",type:"number",onChange:s=>n("bill_number",Number(s.target.value)),placeholder:"Enter bill number"}),e.jsx(i,{message:l.bill_number,className:"mt-2"})]}),a.months>0?e.jsxs("div",{className:"grow",children:[e.jsx(t,{htmlFor:"extra_discount",children:"Extra Discount"}),e.jsx(o,{id:"extra_discount",type:"number",onChange:s=>n("extra_discount",Number(s.target.value)),placeholder:"Enter extra discount"}),e.jsx(i,{message:l.extra_discount,className:"mt-2"})]}):e.jsxs("div",{className:"grow",children:[e.jsx(t,{htmlFor:"days_count",children:"Days Count"}),e.jsx(o,{id:"days_count",placeholder:"Enter total number of days",type:"number",onChange:s=>n("days_count",Number(s.target.value)),required:!0,min:new Date(Date.now()+864e5).toISOString().split("T")[0]}),e.jsx(i,{message:l.days_count,className:"mt-2"})]})]})]})]})]}),e.jsxs("div",{className:"lg:col-span-6 xl:col-span-5 2xl:col-span-4 space-y-2",children:[e.jsx(y,{children:e.jsxs(w,{className:"gap-2 flex flex-col flex-wrap",children:[e.jsx("div",{className:"text-lg mb-2 mt-2",children:e.jsx("strong",{children:"Emergency Information"})}),e.jsxs("div",{className:"grow",children:[e.jsx(t,{htmlFor:"emergency_person_name",children:"Person Name"}),e.jsx(o,{id:"emergency_person_name",value:a.emergency_person_name,onChange:s=>n("emergency_person_name",s.target.value),placeholder:"Enter emergency contact person name"}),e.jsx(i,{message:l.emergency_person_name,className:"mt-2"})]}),e.jsxs("div",{className:"grow",children:[e.jsx(t,{htmlFor:"emergency_person_phone",children:"Phone"}),e.jsx(o,{id:"emergency_person_phone",value:a.emergency_person_phone,onChange:s=>n("emergency_person_phone",s.target.value),placeholder:"Enter emergency contact phone number"}),e.jsx(i,{message:l.emergency_person_phone,className:"mt-2"})]})]})}),e.jsx(y,{children:e.jsxs(w,{children:[e.jsx("div",{className:"text-lg mb-2 mt-2",children:e.jsx("strong",{children:"Pricing Summary"})}),e.jsx("div",{className:"text-start mb-1",children:e.jsx("strong",{children:(D=j.find(s=>s.id===a.membership_package))==null?void 0:D.package_name})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(t,{children:"Admission Amount"}),e.jsxs("span",{children:["Rs ",T]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(t,{children:"Monthly Amount"}),e.jsxs("span",{children:["Rs ",Y]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(t,{children:"Total Months"}),e.jsxs("span",{children:[a.months," Months"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(t,{children:"Total Monthly Fees"}),e.jsxs("span",{children:["Rs ",B]})]}),e.jsx("div",{className:"border mb-2"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(t,{children:"Gross Package Amount"}),e.jsxs("span",{children:["Rs ",G]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(t,{children:"Package Discount"}),e.jsxs("span",{children:["- Rs ",U]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(t,{children:"Extra Discount"}),e.jsxs("span",{children:["- Rs ",a.extra_discount]})]}),e.jsx("div",{className:"border mb-2"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(t,{children:"Net Package Amount"}),e.jsxs("span",{children:["Rs ",C]})]}),e.jsx("div",{className:"border mb-2"}),e.jsxs("strong",{className:"flex justify-between",children:[e.jsx(t,{children:"Net Amount"}),a.months>0?e.jsxs("span",{className:"cursor-pointer",onClick:()=>n("paid",v()),children:["Rs ",v()]}):e.jsx("input",{id:"paidAmount",className:"w-fit max-w-48 text-end border-0 border-b-2 focus:ring-0  [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",type:"number",min:0,placeholder:"Enter Net Amount",onChange:s=>n("net_amount",Number(s.target.value))})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(t,{children:"Paid Amount (Rs)"}),e.jsx("input",{id:"paidAmount",className:"w-fit max-w-48 text-end border-0 border-b-2 focus:ring-0  [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",type:"number",min:0,placeholder:"Enter Paid Amount",value:a.paid||"",onChange:s=>n("paid",Number(s.target.value))}),e.jsx(i,{message:l.paid,className:"mt-2"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(t,{children:z()}),e.jsxs("span",{children:["Rs ",K()]})]}),e.jsx(ee,{type:"submit",disabled:S,className:"w-full mt-3",children:S?"Processing...":"Confirm and Register"})]})})]})]})})]})]})};export{Me as default};
